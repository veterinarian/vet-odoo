<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <!-- Appointment Tree View -->
    <record id="view_vet_appointment_tree" model="ir.ui.view">
        <field name="name">vet.appointment.tree</field>
        <field name="model">vet.appointment</field>
        <field name="arch" type="xml">
            <tree
                decoration-info="state=='scheduled'"
                decoration-success="state=='done'"
                decoration-muted="state=='cancelled'"
                decoration-warning="has_overlap==True"
            >
                <field name="appointment_date" />
                <field name="patient_id" />
                <field name="owner_id" />
                <field name="appointment_type" />
                <field name="provider_id" />
                <field name="room_id" />
                <field name="state" />
                <field name="name" column_invisible="1" />
                <field name="veterinarian_id" column_invisible="1" />
                <field name="has_overlap" column_invisible="1" />
            </tree>
        </field>
    </record>

    <!-- Appointment Form View -->
    <record id="view_vet_appointment_form" model="ir.ui.view">
        <field name="name">vet.appointment.form</field>
        <field name="model">vet.appointment</field>
        <field name="arch" type="xml">
            <form string="Appointment">
                <header>
                    <button
                        name="action_confirm"
                        string="Confirm"
                        type="object"
                        invisible="state != 'scheduled'"
                        class="oe_highlight"
                    />
                    <button
                        name="action_start"
                        string="Start"
                        type="object"
                        invisible="state != 'confirmed'"
                        class="oe_highlight"
                    />
                    <button
                        name="action_done"
                        string="Complete"
                        type="object"
                        invisible="state != 'in_progress'"
                        class="oe_highlight"
                    />
                    <button
                        name="action_cancel"
                        string="Cancel"
                        type="object"
                        invisible="state not in ['scheduled', 'confirmed']"
                    />
                    <field
                        name="state"
                        widget="statusbar"
                        statusbar_visible="scheduled,confirmed,in_progress,done"
                    />
                </header>
                <sheet>
                    <field name="name" invisible="1" />
                    <field name="overlap_warning" invisible="not overlap_warning" />
                    <group>
                        <group>
                            <field name="patient_id" />
                            <field name="owner_id" />
                            <field name="appointment_type" />
                        </group>
                        <group>
                            <field name="appointment_date" />
                            <field name="duration" />
                            <field
                                name="provider_id"
                                required="1"
                                domain="[('is_provider', '=', True)]"
                                context="{'default_is_provider': True}"
                            />
                            <field name="room_id" required="1" />
                            <field name="veterinarian_id" invisible="1" />
                        </group>
                    </group>
                    <notebook>
                        <page string="Reason for Visit">
                            <field name="reason" placeholder="Reason for visit..." />
                        </page>
                        <page string="Diagnosis &amp; Treatment">
                            <group>
                                <field name="diagnosis" placeholder="Diagnosis..." />
                                <field
                                    name="treatment"
                                    placeholder="Treatment plan..."
                                />
                                <field
                                    name="prescription"
                                    placeholder="Prescription details..."
                                />
                            </group>
                        </page>
                        <page string="Notes">
                            <field name="notes" placeholder="Additional notes..." />
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" />
                    <field name="activity_ids" />
                    <field name="message_ids" />
                </div>
            </form>
        </field>
    </record>

    <!-- Appointment Calendar View -->
    <record id="view_vet_appointment_calendar" model="ir.ui.view">
        <field name="name">vet.appointment.calendar</field>
        <field name="model">vet.appointment</field>
        <field name="arch" type="xml">
            <calendar
                string="Appointments"
                date_start="appointment_date"
                color="provider_id"
                mode="week"
                event_open_popup="true"
                quick_create="false"
            >
                <field name="patient_id" />
                <field name="owner_id" />
                <field name="appointment_type" />
                <field name="provider_id" />
                <field name="room_id" />
                <field name="state" />
            </calendar>
        </field>
    </record>

    <!-- Appointment Timeline View (Room Schedule) -->
    <record id="view_vet_appointment_timeline" model="ir.ui.view">
        <field name="name">vet.appointment.timeline</field>
        <field name="model">vet.appointment</field>
        <field name="arch" type="xml">
            <timeline
                date_start="appointment_date"
                date_stop="appointment_date_end"
                default_group_by="room_id"
                event_open_popup="true"
                show_row_name="1"
                colors="#ec7063:state=='cancelled';#2ecc71:state=='done';#3498db:state=='in_progress';#f39c12:state=='confirmed';#95a5a6:state=='scheduled'"
            >
                <field name="room_id" />
                <field name="patient_id" />
                <field name="owner_id" />
                <field name="provider_id" />
                <field name="state" />
            </timeline>
        </field>
    </record>

    <!-- Appointment Search View -->
    <record id="view_vet_appointment_search" model="ir.ui.view">
        <field name="name">vet.appointment.search</field>
        <field name="model">vet.appointment</field>
        <field name="arch" type="xml">
            <search string="Search Appointments">
                <field name="name" />
                <field name="patient_id" />
                <field name="owner_id" />
                <field name="provider_id" />
                <field name="room_id" />
                <field name="veterinarian_id" />
                <filter
                    string="Today"
                    name="today"
                    domain="[('appointment_date', '&gt;=', datetime.datetime.combine(context_today(), datetime.time(0,0,0))), ('appointment_date', '&lt;=', datetime.datetime.combine(context_today(), datetime.time(23,59,59)))]"
                />
                <filter
                    string="This Week"
                    name="this_week"
                    domain="[('appointment_date', '&gt;=', (context_today() - datetime.timedelta(days=context_today().weekday())).strftime('%Y-%m-%d')), ('appointment_date', '&lt;=', (context_today() + datetime.timedelta(days=6-context_today().weekday())).strftime('%Y-%m-%d'))]"
                />
                <filter
                    string="Scheduled"
                    name="scheduled"
                    domain="[('state', '=', 'scheduled')]"
                />
                <filter
                    string="Confirmed"
                    name="confirmed"
                    domain="[('state', '=', 'confirmed')]"
                />
                <filter
                    string="In Progress"
                    name="in_progress"
                    domain="[('state', '=', 'in_progress')]"
                />
                <filter string="Done" name="done" domain="[('state', '=', 'done')]" />
                <filter
                    string="Has Overlap"
                    name="has_overlap"
                    domain="[('has_overlap', '=', True)]"
                />
                <group expand="0" string="Group By">
                    <filter
                        string="Patient"
                        name="group_patient"
                        context="{'group_by': 'patient_id'}"
                    />
                    <filter
                        string="Provider"
                        name="group_provider"
                        context="{'group_by': 'provider_id'}"
                    />
                    <filter
                        string="Room"
                        name="group_room"
                        context="{'group_by': 'room_id'}"
                    />
                    <filter
                        string="Veterinarian"
                        name="group_vet"
                        context="{'group_by': 'veterinarian_id'}"
                    />
                    <filter
                        string="Type"
                        name="group_type"
                        context="{'group_by': 'appointment_type'}"
                    />
                    <filter
                        string="Status"
                        name="group_state"
                        context="{'group_by': 'state'}"
                    />
                    <filter
                        string="Date"
                        name="group_date"
                        context="{'group_by': 'appointment_date'}"
                    />
                </group>
            </search>
        </field>
    </record>

    <!-- Appointment Action -->
    <record id="action_vet_appointment" model="ir.actions.act_window">
        <field name="name">Appointments</field>
        <field name="res_model">vet.appointment</field>
        <field name="view_mode">calendar,timeline,tree,form</field>
        <field name="context">{'search_default_today': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Schedule your first appointment!
            </p>
            <p>
                Manage appointments for your veterinary clinic.
            </p>
        </field>
    </record>

    <!-- New Appointment Action (for button) -->
    <record id="action_vet_appointment_new" model="ir.actions.act_window">
        <field name="name">New Appointment</field>
        <field name="res_model">vet.appointment</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>
</odoo>
